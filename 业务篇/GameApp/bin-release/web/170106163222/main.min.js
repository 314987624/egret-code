var AssetAdapter=function(){function e(){}var t=(__define,e),a=t.prototype;return a.getAsset=function(e,t,a){function n(n){t.call(a,n,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?n(i):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BasePanel=function(e){function t(){e.call(this),GameManager.stage.addEventListener(egret.Event.RESIZE,this.onResize,this),this.onResize()}__extends(t,e);var a=(__define,t),n=a.prototype;return n.onResize=function(){this.onResizeHandler()},n.onResizeHandler=function(){this.height=GameManager.stage.stageHeight},n.childrenCreated=function(){LayerManager.fixScreen(),this.init()},n.init=function(){},n.addButtonEvent=function(e,t,a){e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,t,a||this)},n.removeButtonEvent=function(e,t,a){e&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,a||this)},t}(eui.Component);egret.registerClass(BasePanel,"BasePanel");var GameData=function(){function e(){}var t=(__define,e);t.prototype;return e.getResult=function(e){return 10>=e?"看来你的算术已经连小学生都不如":e>10&&20>=e?"看似还行，还是回去练练吧":e>20&&40>=e?"数学不错喔，不要骄傲。你已经击败了很多人了":e>40&&60>e?"数学心算高手，击败了全国80%的人":e>=60?"我已经是算术大神，击败了全国90%的人,谁不服来挑战我":""},e.getTitle=function(e){return 10>=e?"傻逼":e>10&&20>e?"小学生":e>=20&&40>e?"心算中级生":e>=40&&60>e?"算术大牛":e>=60?"精算师":""},e.createQuest=function(e){var t=Math.ceil(Math.random()*e),a=Math.ceil(Math.random()*e),n=t+a,i=n+Math.ceil(Math.ceil(.3*n)*Math.random()),s=n-Math.ceil(Math.ceil(.3*n)*Math.random()),r=[],o=Math.random();r=.5>o?[n,i,s]:o>=.5&&.7>o?[i,n,s]:o>=.7&&.8>=o?[i,s,n]:o>=.9?[s,n,i]:[s,i,n];var h={label:t+"+"+a+"=?",qs:r,result:n+""};return h},e.levelNumber=10,e}();egret.registerClass(GameData,"GameData");var GameManager=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameManager,"GameManager");var LayerManager=function(){function e(){}var t=(__define,e);t.prototype;return e.init=function(t){GameManager.stage=t,t.addChild(e.gameLayer),t.addChild(e.alertLayer)},e.fixScreen=function(){egret.Capabilities.isMobile?GameManager.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:GameManager.stage.scaleMode=egret.StageScaleMode.SHOW_ALL},e.alertLayer=new egret.Sprite,e.gameLayer=new egret.Sprite,e}();egret.registerClass(LayerManager,"LayerManager");var EndGamePanel=function(e){function t(){e.call(this),this.skinName="EndGamePanelSkin"}__extends(t,e);var a=(__define,t),n=a.prototype;return n.init=function(){this.addButtonEvent(this.startBtn,this.onStartGame),this.addButtonEvent(this.shareBtn,this.showMask)},n.onStartGame=function(){LayerManager.gameLayer.removeChild(this);var e=new GamePanel;LayerManager.gameLayer.addChild(e)},n.setResult=function(e,t,a){this.resultTxt.text=e,this.scoreTxt.text=t+"",this.titleTxt.text=a;var n="获得"+t+"分,收获"+a+"称号，"+e;share(n)},n.showMask=function(){null==this.sp&&(this.sp=new egret.Sprite,this.shareTip=new egret.Bitmap,this.shareTip.texture=RES.getRes("share_tip_png"),this.shareTip.x=GameManager.stage.stageWidth-320,this.sp.addChild(this.shareTip)),this.sp.graphics.clear(),this.sp.graphics.beginFill(0,.7),this.sp.touchEnabled=!0,this.sp.graphics.drawRect(0,0,GameManager.stage.stageWidth,GameManager.stage.stageHeight),this.sp.graphics.endFill(),this.sp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this),LayerManager.alertLayer.addChild(this.sp);var e=document.getElementById("gameDiv"),t=document.createElement("img");t.src="http://1.moyomoyo.sinaapp.com/Qr-code.png",t.style.width="80%",t.style.height="20%",t.style.position="absolute",e.appendChild(t)},n.onCancle=function(e){LayerManager.alertLayer.removeChild(this.sp)},t}(BasePanel);egret.registerClass(EndGamePanel,"EndGamePanel");var GamePanel=function(e){function t(){e.call(this),this.totalTime=0,this.totalNumer=0,this.skinName="GamePanelSkin"}__extends(t,e);var a=(__define,t),n=a.prototype;return n.init=function(){this.initGameEvent(),this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timeFunc,this),this.initData()},n.initGameEvent=function(){this.addButtonEvent(this.aBtn,this.onSelect),this.addButtonEvent(this.bBtn,this.onSelect),this.addButtonEvent(this.cBtn,this.onSelect),this.addButtonEvent(this.restBtn,this.onRest)},n.initData=function(){GameData.levelNumber=10,this.nextQues()},n.onSelect=function(e){this.iselected=!0;var t=e.currentTarget.label;this.checkRight(t)},n.checkRight=function(e){null!=this.curQuesData&&(e==this.curQuesData.result?(this.totalNumer++,this.mycurNumTxt.text="当前分数:"+this.totalNumer,this.nextQues()):this.gameOver())},n.timeFunc=function(e){this.totalTime--,this.totalTime>0?this.timeTxt.text=this.totalTime+"":this.gameOver()},n.nextQues=function(){this.totalTime=4,this.timeTxt.text=this.totalTime+"",this.iselected=!1,this.timer.start();var e=this.getLevel();this.curQuesData=GameData.createQuest(e),null!=this.curQuesData&&this.setButtonState(this.curQuesData.qs,this.curQuesData.label)},n.getLevel=function(){return this.totalNumer>GameData.levelNumber&&(GameData.levelNumber+=20),GameData.levelNumber},n.setButtonState=function(e,t){this.aBtn.label=e[0]+"",this.bBtn.label=e[1]+"",this.cBtn.label=e[2]+"",this.quesLabel.text=t},n.gameOver=function(){this.timer.stop();var e=this.totalNumer;LayerManager.gameLayer.removeChild(this);var t=new EndGamePanel,a=GameData.getResult(e),n=GameData.getTitle(e);t.setResult(a,e,n),LayerManager.gameLayer.addChild(t)},n.onRest=function(e){this.timer.stop(),LayerManager.gameLayer.removeChild(this);var a=new t;LayerManager.gameLayer.addChild(a)},t}(BasePanel);egret.registerClass(GamePanel,"GamePanel");var WelComePanel=function(e){function t(){e.call(this),this.skinName="WelComePanelSkin"}__extends(t,e);var a=(__define,t),n=a.prototype;return n.init=function(){this.addButtonEvent(this.startBtn,this.onStartGame)},n.onStartGame=function(e){LayerManager.gameLayer.removeChild(this);var t=new GamePanel;LayerManager.gameLayer.addChild(t)},t}(BasePanel);egret.registerClass(WelComePanel,"WelComePanel");var LoadingUI=function(e){function t(){e.call(this),this.num=0,this.createView()}__extends(t,e);var a=(__define,t),n=a.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){0==this.num?this.textField.text="Loading."+e+"/"+t:1==this.num?this.textField.text="Loading.."+e+"/"+t:this.textField.text="Loading..."+e+"/"+t,this.num++,this.num>=2&&(this.num=0)},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var a=(__define,t),n=a.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.startCreateScene=function(){LayerManager.init(this.stage);var e=new WelComePanel;LayerManager.gameLayer.addChild(e)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),a=t.prototype;return a.getTheme=function(e,t,a,n){function i(e){t.call(n,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),a.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);